{% extends 'master.html' %}

{% block content %}
  <section class="container-fluid">
      <section class="col-md-6">
        <form method="POST" id="code-form">
          {% csrf_token %}
          <section class="form-group">
              <label for="code"><h2>Write your code here:</h2></label>
              <textarea class="form-control" id="code" name="code" rows="25" cols="40"></textarea>
          </section>
          <section class="form-group">
              <label for="input" style="margin-left: 700px;margin-top: -680px;"><h2>Input:</h2></label>
              <textarea class="form-control" id="input" name="input" rows="2" cols="10" style="margin-left: 700px;margin-top: -629px; margin-right: 100px;"></textarea>
          </section>
          <button type="submit" class="btn btn-primary" id="compile-btn">Compile and Test</button>
          <button type="button" class="btn btn-success" id="run-btn">Run Code</button>
        </form>
        <br>
        
        <div id="output-container" ></div>
      </section>
      
    
  </section>

  <script>
    var form = document.getElementById("code-form");

    $(document).ready(function() {
    $('#code-form').submit(function(event) {
      event.preventDefault();
      execute_code();
    });
  });

  function execute_code() {
    var code = $('#code').val().trim();
    var input = $('#input').val().trim();

    $.ajax({
      url: '',
      method: 'POST',
      headers: { 'X-Requested-With': 'XMLHttpRequest' },
      data: {
        'code': code,
        'input': input,
        'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val()
      },
      success: function(response) {
        var output_container = $('#output-container');
        output_container.empty();

        var output = response.trim();
        output_container.append('<hr><h4>Output:</h4><pre>' + output + '</pre>');
      },
      error: function(xhr, status, error) {
        alert('Error: ' + error);
      }
    });
var runBtn = document.getElementById("run-btn");
runBtn.addEventListener("click", function() {
  form.action = "{% url 'judge:result' id=id %}";
  form.submit();
});
  }
  </script>
{% endblock %}
