{% extends 'master.html' %}

{% block content %}

  <section class="container-fluid">
    <section class="row">
        <form method="POST" id="code-form">
          {% csrf_token %}
          <section class="form-group"><br>
              <label for="code"><h2>Write your code here:</h2></label>
              <div id="editor" style="width: 60%; height: 630px;"></div>
              <textarea class="form-control" id="code" name="code" rows="25" cols="40" style="display:none;"></textarea>
          </section>
          <section class="form-group">
              <label for="input" style="margin-left: 850px;margin-top: -650px;"><h2>Sample Input:</h2></label>
              <textarea class="form-control" id="input" name="input" rows="2" style="margin-left: 880px;margin-top: -600px; width: 15%;"></textarea>
          </section>
          <button type="submit" class="btn btn-primary" id="compile-btn" style="margin-left: 550px;margin-top: 0px;">Compile and Run</button>
          <button type="button" class="btn btn-success" id="run-btn" style="margin-left: 20px; margin-top: 0px;">Submit Code</button>
        </form>
        <br>
        
        <div id="output-container" style="margin-left: 880px;margin-top: -600px; max-width: 500px; height: 150px;"></div>
      </section>
    </section>
    
    <script>
    var form = document.getElementById("code-form");

    var editor = ace.edit("editor");
    editor.setTheme("ace/theme/twilight");
    editor.getSession().setMode("ace/mode/c_cpp");
    editor.setOptions({
    fontSize: "15pt"
    });

    $(document).ready(function() {
    $('#code-form').submit(function(event) {
      event.preventDefault();
      $('#code').val(editor.getValue());
      execute_code();
    });
  });

  function execute_code() {
    var code = $('#code').val().trim();
    var input = $('#input').val().trim();

    $.ajax({
      url: '',
      method: 'POST',
      headers: { 'X-Requested-With': 'XMLHttpRequest' },
      data: {
        'code': code,
        'input': input,
        'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val()
      },
      success: function(response) {
        var output_container = $('#output-container');
        output_container.empty();

        var output = response.trim();
        output_container.append('<hr><h4>Output:</h4><pre>' + output + '</pre>');
      },
      error: function(xhr, status, error) {
        alert('Error: ' + error);
      }
    });
    var runBtn = document.getElementById("run-btn");
    runBtn.addEventListener("click", function() {
     form.action = "{% url 'judge:result' id=id %}";
    form.submit();
    });

  }
  </script>
  
{% endblock %}
