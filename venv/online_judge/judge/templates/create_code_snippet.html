{% extends 'master.html' %}

{% block content %}

<div class="container">
  <div class="row">
    <div class="col-md-8 offset-md-2">
      <form method="POST" id="code-form">
        {% csrf_token %}
        <div class="form-group">
          <label for="code">Write your code here:</label>
          <textarea class="form-control" id="code" name="code" rows="10"></textarea>
        </div>
        <div class="form-group">
          <label for="input">Input (optional):</label>
          <textarea class="form-control" id="input" name="input" rows="5"></textarea>
        </div>
        <button type="submit" class="btn btn-primary" id="test-btn">Test Code</button>
      </form>

      <div id="output-container"></div>

      {% if results %}
      <hr>
      <h4>Results:</h4>
      {% for result in results %}
        <div class="card bg-light mb-3">
          <div class="card-body">
            <h5>Input:</h5>
            <p>{{ result.input|join:'' }}</p>
            <h5>Expected Output:</h5>
            <p>{{ result.expected_output|join:' ' }}</p>
            <h5>Actual Output:</h5>
            <p>{{ result.actual_output|join:' ' }}</p>
            <h5>Verdict:</h5>
            <p>{{ result.verdict }}</p>
          </div>
        </div>
      {% endfor %}
      {% endif %}
    </div>
  </div>
</div>

<script>
  $(document).ready(function() {
    $('#code-form').submit(function(event) {
      event.preventDefault(); // prevent default form submission behavior
      execute_code();
    });
  });

  function execute_code() {
    var code = $('#code').val().trim();
    var input = $('#input').val().trim();

    $.ajax({
      url: '',
      method: 'POST',
      headers: { 'X-Requested-With': 'XMLHttpRequest' },
      data: {
        'code': code,
        'input': input,
        'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val()
      },
      success: function(response) {
        var output_container = $('#output-container');
        output_container.empty();
        var output = response.trim();
        output_container.append('<hr><h4>Output:</h4><pre>' + output + '</pre>');

        $('#code').val(code); // set the code textarea value to the original code
      },
      error: function(xhr, status, error) {
        alert('Error: ' + error);
      }
    });
  }
</script>

{% endblock %}
