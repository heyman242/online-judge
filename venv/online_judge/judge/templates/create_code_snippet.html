{% extends 'master.html' %}

{% block content %}
<div class="container">
  <div class="row">
    <div class="col-md-8 offset-md-2">
      <h2>{{ question.title }}</h2>
      <p>{{ question.body }}</p>

      <form method="POST" id="code-form">
        {% csrf_token %}
        <div class="form-group">
          <label for="code">Write your code here:</label>
          <textarea class="form-control" id="code" name="code" rows="10"></textarea>
        </div>

        <div class="form-group">
          <label for="input">Input (optional):</label>
          <textarea class="form-control" id="input" name="input" rows="5"></textarea>
        </div>

        <button type="submit" class="btn btn-primary" id="test-btn">Test Code</button>
      </form>

      {% if output %}
      <hr>
      <div class="card bg-light">
        <div class="card-body">
          <h4>Output:</h4>
          <pre>{{ output }}</pre>
        </div>
      </div>
      {% endif %}

      {% if results %}
      <hr>
      <h4>Results:</h4>
      {% for result in results %}
      <div class="card bg-light mb-3">
        <div class="card-body">
          <h5>Input:</h5>
         <tr>
    <td>{{ result.input|join:', ' }}</td>
    <td>{{ result.expected_output|join:', ' }}</td>
    <td>{{ result.actual_output|join:', ' }}</td>
    <td>{{ result.verdict|join:', ' }}</td>
  </tr>
        </div>
      </div>
      {% endfor %}
      {% endif %}

    </div>
  </div>
</div>

<script>
  $(document).ready(function() {
    $('#code-form').submit(function(event) {
      event.preventDefault();
      execute_code();
    });
  });

  function execute_code() {
    var code = $('#code').val().trim();
    var input = $('#input').val().trim();

    $.ajax({
      url: '',
      method: 'POST',
      headers: { 'X-Requested-With': 'XMLHttpRequest' },
      data: {
        'code': code,
        'input': input,
        'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val()
      },
      success: function(response) {
        var output = response.trim();
        $('#output').html(output);
        $('#results').html('');
      },
      error: function(xhr, status, error) {
        alert('Error: ' + error);
      }
    });
  }
</script>
{% endblock %}
